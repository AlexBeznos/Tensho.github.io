---
title: Маленький вопрос о больших (?) размерах Docker образов
---

Сегодня меня поставили в тупик вопросом о размере Docker образа в случае добавления и удаления из него файлов в процессе построения. Имея представление о слоевой файловой системе ([OverlayFS](https://en.wikipedia.org/wiki/OverlayFS) по умолчанию на текущий момент) в Docker я сразу же дал ответ, но когда мой ответ уверенно назвали неверным, я засомневался, хорошо ли я понимаю слои образов. Поэтому я решил перепроверить мои догадки, чтобы завтра с уверенностью сказать, что я таки прав ^_^ Чтобы не вдаваться в конкретные формулировки я просто приведу пример `Dockerfile` и задам вопрос своими словами:

```Dockerfile
FROM java:alpine                # 145 Mb

COPY filename.ext /filename.ext # 55 Mb

RUN rm -rf /filename.ext        # ? Mb
```

Нам известно, что базовый образ `java:alpine` занимает скажем 145 Мб, а файл `filename.ext` занимает скажем 55 Мб. Сколько будет занимать финальный образ после выполнения всех команд внутри `Dockerfile`?

Мой ответ был **200 (145 + 55) Мб**, хотя мой оппонент утверждал, что правильный ответ – **255 (145 + 55 + 55) Мб**. Давайте разберемся на примере, где же правда. Java я не очень люблю, поэтому возьму для замеров базовый образ `ruby:alpine`.

* 1

```Dockerfile
FROM ruby:alpine
```

```
$ docker build -t probe:1 .
$ docker images --format "{{.Size}}" probe:1
66.2MB
```

* 2

```Dockerfile
FROM ruby:alpine

COPY north.m4a /north.m4a
```

```
$ docker build -t probe:2 .
$ docker images --format "{{.Size}}" probe:2
70.8MB
```

* 3

```Dockerfile
FROM ruby:alpine

COPY north.m4a /north.m4a

RUN rm -rf /north.m4a
```

```
$ docker build -t probe:3 .
$ docker images --format "{{.Size}}" probe:3
70.8MB
```

Как видно из шагов эксперимента образ не потолстел после удаления файла (шаг 3), ЧТД – что и требовалость доказать.
